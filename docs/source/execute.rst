.. highlight:: plain

Using InfraRed
================

General use
-----------
InfraRed framework is divided into three logically separated stages (tools):

* ``ir-provisioner``

* ``ir-installer``

* ``ir-tester``

First, create InfraRed config file::

  cp infrared.cfg.example infrared.cfg

.. note:: There is an environment variable called IR_CONFIG that controls the location of the config file (defaults to: ./infrared.cfg). Use if you wish to override local one.

  .. code-block:: plain

    IR_CONFIG=/my/config/file.ini ir-provision --help

You can get general usage information with the ``--help`` option::

  ir-provisioner --help

Output will display supported options you can pass to ``ir-provision``, as well as available positional arguments for current stage (e.g. for provisioner these are foreman, virsh, openstack, ...):

.. code-block:: plain

    usage: ir-provisioner [-h] [--inventory INVENTORY] [-v] [-d]
                          {openstack,beaker,foreman,virsh} ...

    positional arguments:
      {openstack,beaker,foreman,virsh}
        openstack           Provision systems using Ansible OpenStack modules
        beaker              Provision systems using Beaker
        foreman             Provision systems using Foreman
        virsh               Provision systems using virsh

    optional arguments:
      -h, --help            show this help message and exit
      --inventory INVENTORY
                            Inventory file (default: local_hosts)
      -v, --verbose         Control Ansible verbosity level
      -d, --debug           Run InfraRed in DEBUG mode

Also, you can invoke help for specific positional arguments (supported provisioners, in this case)::

  ir-provisioner beaker --help

.. note:: Positional arguments are generated dynamically from spec files - order and amount might change in time.


Provisioners
------------
For list of supported provisioners invoke::

    $ ir-provisioner -h

Beaker
^^^^^^

Foreman
^^^^^^^

Openstack
^^^^^^^^^

Virsh
^^^^^
Virsh provisioner requires prepared host to be accessible through SSH key. Please see `Quickstart <quickstart.html#settings-provisioner-virsh-image-sample-yml-example>`_ guide where usage is demonstrated.

Installers
----------
For list of supported installers invoke::

    $ ir-installer -h

Packstack
^^^^^^^^^
Infrared allows to use Packstack installer to install OpenStack::

    $ ir-installer -d -vvvv --inventory hosts packstack --product-version=8 -o install.yml -e @provision.yml

Here required arguments are:
    * ``--product-version`` - the product version to install.

Optional arguments:
    * ``-o provision.yml`` - the settings file generated by provisiner (using ``ir-provisioner [...] -o provision.yml [...]``). It might contain relevant data required for Packstack settings.


Settings structure
""""""""""""""""""

The path for the main settings file for packstack installer::

    settings/installer/packstack/packstack.yml

This file provides defaults settings and default configuration options for the packstack answer files.

Additional answer options can be added using the the following approaches:

    * Using a non default config argument value::

        $ ir-installer --inventory hosts packstack --config=basic_neutron.yml

    * Using the extra-vars flags::

        $ ir-installer --inventory hosts packstack --product-version=8 --extra-vars=installer.config.CONFIG_DEBUG_MODE=no

    * Network based answer file options can be selected whether by choosing network backend or by modyfing config with --extra-vars::

        $ ir-installer --inventory hosts packstack --product-version=8 --network=neutron.yml --netwrok-variant=neutron_gre.yml

        $ ir-installer --inventory hosts packstack --product-version=8 --network=neutron.yml --netwrok-variant=neutron_gre.yml --extra-vars=installer.network.config.CONFIG_NEUTRON_USE_NAMESPACES=n

Both installer.network.config.* and installer.config.* options will be merged into one config and used as the answer file for Packstack installer.installer

OpenStack Director
^^^^^

Testers
-------
For list of supported testers invoke::

    $ ir-tester -h

Tempest
^^^^^^^

Rally
^^^^^
