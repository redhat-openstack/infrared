# This file is used once per node in 'overcloud_nodes' group
- name: Deploy openstack-bmc service file
  template:
      src: "openstack-bmc-service.j2"
      dest: "/usr/lib/systemd/system/openstack-bmc-{{ node.human_id }}.service"

- name: Start the service for the node
  service:
      name: "openstack-bmc-{{ node.human_id }}.service"
      state: started
      enabled: yes

- name: Update our host with it's ipmi ip
  vars:
      base_subnet: "{{ internal_default_gateway.split('.')[:-1] | join('.') }}"
      last: "{{ node.private_v4.split('.')[-1] }}"
  add_host:
      name: "{{ node.human_id }}"
      ipmi_ip: "{{ base_subnet }}.{{ last }}"
