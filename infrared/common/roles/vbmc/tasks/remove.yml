---
- name: check for any vbmc processes
  command: pgrep vbmc
  register: vbmc_proc
  ignore_errors: true

- name: remove existing Virtual BMCs
  shell: |
      vbmc stop {{ hostvars[vbmc_node].original_name|default(vbmc_node) }}
      vbmc delete {{ hostvars[vbmc_node].original_name|default(vbmc_node) }}
  ignore_errors: true
  when:
      - vbmc_proc.rc == 0
      - vbmc_node is defined
