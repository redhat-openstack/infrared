---
- name: Install packages required for 'pxe_ipmitool' ironic's driver on RedHat based distros
  become: true
  package:
      name:
        - python-setuptools
        - ipmitool
      state: latest
      disable_gpg_check: yes

- name: Install python-virtualbmc from repo's
  become: true
  package:
      name: python-virtualbmc
      state: latest
      disable_gpg_check: yes
  changed_when: false
  ignore_errors: true
  register: virtualbmc_install_result

- block:
    - name: Install packages required for python-virtualbmc pip package
      become: true
      package:
          name:
            - gcc
            - libvirt
            - libvirt-devel
            - python-devel
            - python-virtualenv
          state: latest
          disable_gpg_check: yes

    - name: install pip
      become: yes
      easy_install:
          name: pip

    - name: Install python-virtualbmc with pip
      pip:
          virtualenv: "{{ vbmc_virtualenv }}"
          virtualenv_site_packages: yes
          name: virtualbmc
          state: latest
  when: virtualbmc_install_result.rc != 0
