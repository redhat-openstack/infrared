- block:
      - include_tasks: install.yml
        delegate_to: "{{  vbmc_inventory_host }}"

      - include_tasks: configure.yml
        delegate_to: "{{  vbmc_inventory_host }}"

      - include_tasks: iptables.yml
        delegate_to: "{{  vbmc_inventory_host }}"
        when: vbmc_inventory_host == "hypervisor"

      - name: Register vars for instackenv template
        set_fact:
            vbmc_ports: "{{ vbmc_ports }}"
            vbmc_management_address: "{{ vbmc_management_address }}"
  when: action is defined and action == 'install'

- include_tasks: check.yml
  when: action is defined and action == 'check'

- include_tasks: cleanup.yml
  when: action is defined and action == 'cleanup'
