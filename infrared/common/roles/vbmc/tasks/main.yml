- name: set vars
  set_fact:
      overcloud_deploy: "no"

- block:
      - include_tasks: install.yml
        delegate_to: "{{  vbmc_inventory_host }}"

      - include_tasks: configure.yml
        delegate_to: "{{  vbmc_inventory_host }}"

      - include_tasks: iptables.yml
        delegate_to: "{{  vbmc_inventory_host }}"

      - name: Register vars for instackenv template
        set_fact:
            vbmc_ports: "{{ vbmc_ports }}"
            vbmc_management_address: "{{ vbmc_management_address }}"
  when: action is undefined

- include_tasks: check.yml
  when: action is defined and action == 'check'
