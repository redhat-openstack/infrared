- name: External network creation
  hosts: controller[0]
  gather_facts: no
  vars:
      export_tasks:
          default: external_network_default.yml
          RedHat_6: external_network_rhel6x.yml
  tasks:
      - name: get the default floating ip pool name from the controller
#        delegate_to: "{{ first_controller }}"
        become_user: root
        become: yes
        shell: "grep -oP '(?<=default_floating_pool=)(.*$)' /etc/nova/nova.conf"
        register: pool_name

      - name: grab auth data from openstackrc file and publish it as YAML
#        delegate_to: "{{ first_controller }}"
        become_user: root
        become: yes
        shell: |
            source /root/keystonerc_admin
            echo "
            auth_url: $OS_AUTH_URL
            username: $OS_USERNAME
            password: $OS_PASSWORD
            project_name: $OS_TENANT_NAME
            "
        register: creds

      - include: "{{ export_tasks['%s_%s'|format(ansible_distribution,ansible_distribution_major_version)] | default (export_tasks['default'])}}"
