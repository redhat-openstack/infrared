---
- name: install the RPM with the pre-built overcloud images
  become: yes
  vars:
      default_packages: "{{ (install.version|openstack_release >= 15) | ternary(['rhosp-director-images-x86_64', 'rhosp-director-images-ipa-x86_64'], ['rhosp-director-images']) }}"
  package:
      name: "{{ item }}"
      state: latest
  with_items: "{{ install.images.url is defined | ternary(install.images.get('url', '').split(','), default_packages) }}"

# todo(yfried): investigate gtar error "Warning: Cannot stat: No such file or directory")'
- name: untar the images
  become: yes
  unarchive:
      src: "/usr/share/rhosp-director-images/{{ item }}"
      dest: "~{{ install.user.name }}/"
      copy: no
      owner: "{{ install.user.name }}"
      group: "{{ install.user.name }}"
      list_files: yes
  register: image_files
  with_items: "{{ tar_images }}"
