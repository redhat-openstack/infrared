- name: Check if we have shade node in groups
  hosts: localhost
  tags: shade
  gather_facts: yes
  any_errors_fatal: true
  tasks:
      - name: Adding host to 'shade' group
        vars:
          shade_group: "{{ groups.hypervisor|default(groups.undercloud) }}"
        add_host:
          name: "{{ shade_group|first }}"
          groups: "shade"

      - name: update inventory
        template:
            dest: "{{ inventory_dir }}/hosts-install"
            src: inventory.j2

      - name: update inventory file symlink
        file:
            src: "hosts-install"
            dest: "{{ inventory_dir }}/hosts"
            state: link

- name: Prepare shade node
  hosts: shade
  tags: shade
  gather_facts: yes
  become: yes
  any_errors_fatal: true
  roles:
      - role: shade
