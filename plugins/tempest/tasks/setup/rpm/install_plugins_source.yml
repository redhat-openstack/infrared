- name: Install git
  become: yes
  package:
      name: "git"
      state: present

# not using easy_install due to problems similar to https://github.com/pypa/pip/issues/4596
- name: Install pip using get-pip.py
  shell: |
      curl https://bootstrap.pypa.io/get-pip.py | {{ ansible_python_interpreter | default('python') }}
  become: true
  when: ansible_python_version is version('3', '<')

- name: Install python3-pip
  package:
      name: python3-pip
      state: present
  become: true
  when: ansible_python_version  is version('3', '>=')

- name: Create plugins directory
  file:
      state: directory
      path: "{{ plugins_dir }}"

- set_fact:
        repos: "{{ plugin_dict.value.repo is defined | ternary([plugin_dict.value.repo], plugin_dict.value.repos) }}"

- name: Loop over tempest plugins
  include_tasks: install_multiple_plugins.yml
  with_items: "{{ repos }}"
  loop_control:
    loop_var: repo
