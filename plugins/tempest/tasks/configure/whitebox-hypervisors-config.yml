- name: Get Compute node IP inventory
  shell: "source /home/stack/stackrc && openstack server list -f value -c Name -c Networks | grep -i compute | sort -h"
  register: ip_inventory
- name: Get hypervisor inventory
  shell: "source /home/stack/overcloudrc.v3 && openstack hypervisor list -f value -c \"Hypervisor Hostname\" | sort -h"
  register: hostname_inventory
- name: Map host with corresponding IP
  vars:
    final_compute: ''
  set_fact:
    final_compute: "{{ item.0.split() | first }}:{{ item.1.split('ctlplane=')[1] }},{{ final_compute | default('') }}"
  with_together:
    - "{{ hostname_inventory.stdout_lines }}"
    - "{{ ip_inventory.stdout_lines }}"
  when: '"{{ item.1.split() | first }}" in "{{ item.0.split() | first }}"'
