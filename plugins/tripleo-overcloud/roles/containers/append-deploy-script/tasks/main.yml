- name: append ceph-ansible template
  lineinfile:
      dest: "{{ containers_ir_deploy_script }}"
      line: '-e {{ install.heat.templates.basedir }}/environments/ceph-ansible/ceph-ansible.yaml \'
  when:
      - not install.storage.external
      - storage_backend|default('') == 'ceph'

- name: "Workaround BZ#1538015: append container templates to the build scripts"
  lineinfile:
      dest: "{{ containers_ir_deploy_script }}"
      line: "{{ item }}"
  with_items:
      - '-e {{ install.heat.templates.basedir }}/environments/docker.yaml \'
      - '-e {{ install.heat.templates.basedir }}/environments/docker-ha.yaml \'
  when:
      - install.version|default(undercloud_version)|openstack_release == 13

- name: Include required OVN template (BZ#1545085)
  lineinfile:
      dest: "~/overcloud_deploy.sh"
      line: '-e {{ install.heat.templates.basedir }}/environments/services-docker/neutron-ovn-ha.yaml'
  when:
      - install.network.ovn
      - install.version|default(undercloud_version)|openstack_release >= 13