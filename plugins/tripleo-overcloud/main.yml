- include: init.yml
  tags:
      - init
      - ironic

- name: Deploy loadbalancer
  include: loadbalancer.yml
  tags:
      - loadbalancer
      - loadbalancer_setup
  when: "'loadbalancer' in groups"

- include: hypervisor.yml
  tags:
      - hypervisor
      - ironic
      - instack
  when: "'hypervisor' in groups"

- name: Introspect our machines
  include: introspect.yml
  tags: introspection

- name: Tag our machines with proper flavors
  include: tag.yml
  tags: tagging

- name: Populate the overcloud deploy script
  include: build_templates.yml
  tags: templates

- name: Deploy the Overcloud
  include: deploy.yml
  tags: deploy

- name: Update inventory
  include: update_inventory.yml
  tags:
      - inventory_update
      - deploy

- include: create_external_network.yml
  tags:
      - public_network
      - post
  when: install.public.network

- name: Perform post install tasks
  include: post.yml
  tags: post
