---
- name: fix masquerade
  hosts: undercloud
  become: yes
  any_errors_fatal: yes
  gather_facts: no
  tasks:
      - name: "w/a for bz#1460116"
        service:
            name: iptables
            state: restarted

- name: compute related workarounds
  hosts: compute
  become: yes
  any_errors_fatal: yes
  gather_facts: no
  tasks:
      - name: "w/a for 1477720"
        shell: |
           setenforce 0
           iptables -t nat -I POSTROUTING -s 172.18.0.0/16 -j MASQUERADE
        tags: skip_ansible_lint

      - name: "w/a for bz 1459592 and 1469825"
        script: docker_libvirt_rebuild.sh

      - name: "w/a for bz 1464182"
        shell: |
          docker exec -u root -i nova_compute bash -c "echo $(hexdump -n 16 -v -e '/1 "%02x"' /dev/urandom) |tee /etc/machine-id"
