- name: Placeholder for the undercloud pre-tasks
  hosts: undercloud
  gather_facts: yes
  tags: init
  any_errors_fatal: true
  tasks:
       - name: Install pre-defined Undercloud packages
         yum:
             name: "{{ install.undercloud.packages }}"
             state: present
         become: true
         when:
             - install.undercloud is defined
             - install.undercloud.packages

       - name: Retrieve container facts for mistral_executor container
         docker_container:
           name: mistral_executor
         register: mistral_executor
         become: true
         when:
             - install.undercloud is defined
             - install.undercloud.packages

       - name: Verify the image of the mistral_executor container to be passed to below task
         debug: msg="{{ mistral_executor.ansible_facts.docker_container.Config.Image }}"

       - name: Install pre-defined Undercloud packages in Containerized Undercloud for OSP 14+
         docker_container:
           name: mistral_executor
           image: "{{ mistral_executor.ansible_facts.docker_container.Config.Image }}"
           #TODO(skatlapa): check image tag, e.g: 2018-08-20.1
           command: yum localinstall -y {{ install.undercloud.packages }}
           state: started
           restart: yes
           user: root #check vs stack
         become: true
         when:
             - install.undercloud is defined
             - install.undercloud.packages
             - install.version|default(undercloud_version)|openstack_release > 13
             #TODO(skatlapa): Add param in plugin.spec to list/enable this hack/method
