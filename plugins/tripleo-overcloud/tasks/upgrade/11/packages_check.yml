---
- name: Check if there any remaining updates on {{ node_name }}
  become: true
  command: yum check-update
  register: yum_update
  ignore_errors: yes
  delegate_to: "{{ node_name }}"

- block:
    - name: list not-updates packages
      becom: true
      shell: |
          yum check-update 2>&1 | tee
      delegate_to: "{{ node_name }}"

    - fail:
          msg: "There are remaining packages to be updated on {{ hostvars[node_name].ansible_fqdn }} or yum didn't run successfully"
  when: yum_update.rc in [1, 100]
