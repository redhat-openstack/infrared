- name: create directory to store images
  file:
    path: "~/osp_11_images"
    state: directory

- name: untar the images
  become: yes
  unarchive:
      src: "/usr/share/rhosp-director-images/{{ item }}"
      dest: "~/osp_11_images"
      copy: no
      list_files: yes
  with_items:
    - "overcloud-full-latest-11.0.tar"
    - "ironic-python-agent-latest-11.0.tar"

- name: upload the overcloud images to glance
  shell: |
    source ~/stackrc
    openstack overcloud image upload --update-existing
  args:
    chdir: "~/osp_11_images"

- name: assign new images to nodes
  shell: |
    source ~/stackrc
    openstack baremetal configure boot
