---
- name: List custom roles nodes
  shell: |
      source {{ undercloud_rc }}
      openstack server list -f json | jq -r -c '.[] | select(.Name | contains("ceph") or contains("stor-r") or contains("controller") or contains("ctrl") or contains("objectstorage") or contains("swift-r") or contains("compute") or contains("comp") | not ) | .Name'
  register: custom_nodes

- include: custom_roles_upgrade.yml
  with_items: "{{ custom_nodes.stdout_lines }}"
  loop_control:
      loop_var: node_name
