# We currently only support external netapp
- block:
      - name: Print overcloud_deploy.sh script - before copy
        command: "cat {{ overcloud_deploy_script }}"

      - name: Copy storage configuration file to the remote
        copy:
            src: "{{ hostvars['localhost']['install_storage_config_file'] }}"
            dest: "{{ template_base }}/storage-config.yaml"

      - name: Print overcloud_deploy.sh script - before netapp
        command: "cat {{ overcloud_deploy_script }}"

      - name: Append the storage configuration line to the base overcloud deploy script
        lineinfile:
            dest: "~/overcloud_deploy.sh"
            line: '-e {{ template_base }}/storage-config.yaml \'
            insertbefore: "^--log-file.*"

      - name: Print overcloud_deploy.sh script - after netapp
        command: "cat {{ overcloud_deploy_script }}"

  when: install.storage.external
