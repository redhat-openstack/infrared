---
- import_playbook: "{{ provision_cleanup | default('playbooks/cleanup.yml') }}"
  when: (provision.cleanup|default(False)) or (provision.kill|default(False))

- import_playbook: "playbooks/remove_nodes.yml"
  when: provision.get('remove', {}).nodes|default(False)

- import_playbook: "{{ provision_playbook | default('playbooks/provision.yml') }}"
  when:
      - not provision.cleanup|default(False)
      - not provision.kill|default(False)
      - not provision.get('remove', {}).nodes|default(False)

- name: Collect Ansible facts
  import_playbook: 'playbooks/collect-ansible-facts.yml'
  when:
      - provision.collect.ansible.facts|default(False)
      - not provision.cleanup|default(False)
  tags: collect-ansible-facts
  ignore_errors: True
