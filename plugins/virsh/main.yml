---
- include: "{{ provision_cleanup | default('cleanup.yml') }}"
  when: provision.cleanup|default(False)

- include: "{{ provision_playbook | default('provision.yml') }}"
  when: not provision.cleanup|default(False)

- name: Collect Ansible facts
  gather_facts: yes
  hosts: localhost:hypervisor:undercloud
  tasks:
    - name: collect ansible tasks
      block:
        - set_fact:
            ansible_facts_filename: "infrared_virsh-provision_{{ inventory_hostname }}"

        - include_role:
            name: collect-ansible-facts
      when: not provision.cleanup|default(False)
  tags: collect-ansible-facts
