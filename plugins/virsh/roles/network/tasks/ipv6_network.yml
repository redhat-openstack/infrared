- name: Check if interfaces have inet6 address family capabilities
  shell: "ip addr show | grep inet6"
  ignore_errors: True
  register: ipv6_addr

- name: Check if IPv6 enabled on host
  shell: "grep -q ^0$ /sys/module/ipv6/parameters/disable"
  ignore_errors: True
  register: ipv6_sys

- name: Fail if ipv6 is defined, but modules aren't loaded
  fail:
      msg: "Network '{{ item.value.name }}' requires IPv6, but modules aren't loaded..."
  when:
      - (ipv6_addr.rc != 0 or ipv6_sys.rc != 0 )

- name: Print ansible_default_ipv6 fact variable
  debug:
      msg: "Print ansible_default_ipv6: {{ ansible_default_ipv6 }}"

- name: enable router advertisements
  sysctl:
      name: "net.ipv6.conf.{{ ansible_default_ipv6['interface'] }}.accept_ra"
      value: 2
      sysctl_set: yes
      state: present
      reload: yes
  when: "'interface' in ansible_default_ipv6"
