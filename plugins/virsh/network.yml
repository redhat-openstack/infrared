- include_vars: "{{ provision.topology.network|default('vars/topology/networks/3_nets.yml') }}"

- name: check for existing networks
  virt_net:
      command: "list_nets"
  register: network_list

- name: create the networks for the topology
  virt_net:
      command: "define"
      name: "{{ item.value.name }}"
      xml: "{{ lookup('template', 'templates/network.xml.j2') }}"
  with_dict: "{{ networks.values() | map(attribute='name') | list | difference(network_list.list_nets) }}"

- name: check if network is active
  virt_net:
      name: "{{ item.value.name }}"
      state: active
      autostart: yes
  with_dict: "{{ networks }}"
