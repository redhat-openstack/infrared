---
# This file is used to cleanup OpenStack neutron resources

- stat:
      path: "{{ inventory_dir }}/resources/servers.yml"
  register: servers_file

- include: tasks/cleanup/servers.yml
  when: servers_file.stat.exists

- stat:
      path: "{{ inventory_dir }}/resources/routers.yml"
  register: routers_file

- include: tasks/cleanup/routers.yml
  when: routers_file.stat.exists

- stat:
      path: "{{ inventory_dir }}/resources/subnets.yml"
  register: subnets_file

- include: tasks/cleanup/subnets.yml
  when: subnets_file.stat.exists

- stat:
      path: "{{ inventory_dir }}/resources/networks.yml"
  register: networks_file

- include: tasks/cleanup/networks.yml
  when: networks_file.stat.exists

#TODO(aopincar): Add 'security groups' cleanup task

- stat:
      path: "{{ inventory_dir }}/resources/keypairs.yml"
  register: keypairs_file

- include: tasks/cleanup/keypairs.yml
  when: keypairs_file.stat.exists

- name: Fail run if one of neutron cleanups tasks failed/skipped
  fail:
      msg: "The run failed because one of neutron cleanup tasks failed/skipped"
  when: >
      (routers_cleanup|skipped or
       subnets_cleanup|skipped or
       networks_cleanup|skipped or
       keypairs_cleanup|skipped or
       servers_cleanup|skipped)


