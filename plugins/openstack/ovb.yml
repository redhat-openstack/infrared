# performs bmc node cofiguration
- name: Provision Baremetal controller (BMC)
  hosts: bmc
  become: yes
  any_errors_fatal: true
  pre_tasks:
      - include_vars:
          file: "{{ node.value.path }}"
          name: node_dict
        become: no

      - name: merge overriden settings to the separate var
        set_fact:
          topology_node: "{{ node_dict|default({}) | combine((override|default({})).get(node.key, {})) }}"
        become: no
  roles:
      - bmc

- name: Save overcloud nodes host vars
  hosts: localhost
  any_errors_fatal: true
  roles:
      - role: hostvars
        action: save
        host_names: "{{ groups.get('overcloud_nodes', []) }}"
