{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "befda957_c8c14b4c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1016110
      },
      "writtenOn": "2022-01-06T17:23:03Z",
      "side": 1,
      "message": "Doesn\u0027t this additional step already happen in some other cases? Couldn\u0027t the condition there be extended? I mean, if the problem is install.network.ovn|default(False), can\u0027t that be simply removed, or changed a bit so that it\u0027s considered only for \u003c 17?",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e43faab7_a1c71225",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1006223
      },
      "writtenOn": "2022-01-06T17:36:35Z",
      "side": 1,
      "message": "You only need to run openstack tripleo container image prepare prior to deploy in the case where you are running ceph deploy before overcloud install. By default the overcloud deploy process will run this at deployment time so this the condition is that this needs to be run before ceph deployment.  I\u0027m uncertain why the ovn conditional was ever used for this. It might have been to ensure they get the correct containers into the docker-images.yaml which shouldn\u0027t have been used since the `openstack tripleo container image prepare` went live in OSP14 (I think it was 14).",
      "parentUuid": "befda957_c8c14b4c",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e1aba776_10bba14f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1005097
      },
      "writtenOn": "2022-01-07T14:19:15Z",
      "side": 1,
      "message": "Unfortunately, also looking into git history, this is fine example of IR spaghetti-ness. Some job did not work, someone extended mentioned conditional for their use-case to make it work, others copied it, the details are lost in following refactorings, no comments anywhere in code on why... It is what it is - again, unfortunately.\n\nNo, imho \"install.network.ovn|default\" can\u0027t be removed same as any code potentially used by released OSP\u003c17s. As we have close to zero tooling on IR coverage in CI, any decision like that might potentially change behaviour of CI for released OSP unpredictably, again the same argument from https://review.gerrithub.io/c/redhat-openstack/infrared/+/527832 .\n\nI defer to Tuvya as the latest commit owner for related code to provide more insight, but all things considered, this seems to me like the right solution for this case.",
      "parentUuid": "e43faab7_a1c71225",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cfb74c8c_a69b31d9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017127
      },
      "writtenOn": "2022-01-10T15:57:12Z",
      "side": 1,
      "message": "@Luigi are Alex/Filip\u0027s explanations sufficient for why the commit was purposed? Are there any other questions or concerns you would like addressed?",
      "parentUuid": "e1aba776_10bba14f",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d8010d5a_065c85ce",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1016110
      },
      "writtenOn": "2022-01-10T16:14:54Z",
      "side": 1,
      "message": "Thanks",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "98a97d87_9676eeec",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1016110
      },
      "writtenOn": "2022-01-11T10:15:03Z",
      "side": 1,
      "message": "I thought a bit more about it and I\u0027m still not convinced, sorry.\n\nWe are going to have an existing path for every time networking.ovn is set for \u003e\u003d14. This works every time.\nNow we have a superspecial path in all other cases, but what are those cases? Just ovn? Why doesn\u0027t that work with ovn? I disagree with Filip - install.network.ovn can be removed, and it will probably work with older versions.\nWe are just adding more code paths which makes it more complicated to untangle stuff in the future.\n\nSo I\u0027m not going to block this, but not with my vote.",
      "parentUuid": "cfb74c8c_a69b31d9",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e31e32a_cfe7aa3d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1006223
      },
      "writtenOn": "2022-01-11T14:22:59Z",
      "side": 1,
      "message": "You are arguing something outside of the scope of this patch. Honestly I don\u0027t know why there was this ovn condition in the first place as it *shouldn\u0027t* be this way.  This was likely done to address something and wasn\u0027t a correct fix.  From a deployment standpoint in 17 the execution of container image prepare is required if seting up ceph prior to the deployment of the overcloud *and* using push_destination: true.  This is a new workflow required for OSP17 and should be conditionalized separately from the other thing.\n\nThe --output-env-file {{ template_base }}/docker-images.yaml is likely the cause of having to run it with ovn because the defaults if run w/o anything used to generate you an ovs specific container set.  There\u0027s a problem here with the logic but that should be addressed outside the scope of this patch.  Who ever -2\u0027d this please lift that so that we can unblock CI and there should be a ticket/bz/whatever to address the other part of this condition.",
      "parentUuid": "98a97d87_9676eeec",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "61a69335_633ca0c9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1014217
      },
      "writtenOn": "2022-01-12T11:25:07Z",
      "side": 1,
      "message": "What will happened in case we will run image prepare on default !\u003d \u0027ceph\u0027 for OSP17?",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "be08f27a_4194540f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1006992
      },
      "writtenOn": "2022-01-12T13:37:15Z",
      "side": 1,
      "message": "We\u0027re spending a lot of time talking about a conditional which was in place before this patch was proposed. I agree this part of IR is messy but is it in scope to clean it up here? Perhaps it could be tracked in a separate task in the IR backlog since it\u0027s a code clean up and not an unblock?\n\nBack to the most recent question on the conditional...\n\nIf image prepare is run before overcloud deployment for a job without ceph then the deployment will still pass. Based on what I see this is already the case for all OVS jobs so in that sense it\u0027s harmless.\n\nDo you want to open another issue so that image prepare is not run more than once? Under that issue someone could re-write all of the conditionals around this task and if 16 or greater always run image prepare in advance and then have `openstack overcloud deploy` skip the image prepare because it\u0027s already done. To do this, update the file so it has push_destination: true and then when you deploy the overcloud pass this:\n\n  --disable-container-prepare\n  -e {{ template_base }}/docker-images.yaml\n  \nI don\u0027t see --disable-container-prepare in queens and I assume we only want to test 13, 16, 17.\n\nhttps://github.com/openstack/python-tripleoclient/blob/queens-eol/tripleoclient/v1/overcloud_deploy.py#L732",
      "parentUuid": "61a69335_633ca0c9",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bbc0a9f8_85fef087",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1014217
      },
      "writtenOn": "2022-01-12T13:41:55Z",
      "side": 1,
      "message": "Make sense to open a ticket for that. I\u0027ll give the +1 to make this proceed",
      "parentUuid": "be08f27a_4194540f",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "822e17a2_28e9a0e2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1010634
      },
      "writtenOn": "2022-01-13T15:05:24Z",
      "side": 1,
      "message": "I got convinced by Filip on downstream mtg that the infrared branching will most likely cause any issue related to this change non-relevant",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3f290501_3a1a5835",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1005097
      },
      "writtenOn": "2022-01-13T15:19:34Z",
      "side": 1,
      "message": "I will add Amnon\u0027s concerns to the OSP17 techdebt tracker https://issues.redhat.com/browse/RHOSINFRA-4353 - though exactly, if we do per OSP17 branching, these lines are prime candidates to be refactored and nothing like such IR spaghetiness should be produced again. Redoing OSP17 branch from scratch should remove these implicitely, we just need to make sure this recheck will happen(in future, action item) during the remake.",
      "parentUuid": "822e17a2_28e9a0e2",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4fe9cf31_7937ec28",
        "filename": "plugins/tripleo-overcloud/roles/containers/prepare-templates/tasks/build/build_images.yml",
        "patchSetId": 1
      },
      "lineNbr": 135,
      "author": {
        "id": 1014217
      },
      "writtenOn": "2022-01-09T08:47:06Z",
      "side": 1,
      "message": "If release \u003e\u003d 14 it is also 17 for this condition ... I don\u0027t understand the condition for only ceph, if it was not appeared on the previous when condition for \"install.storage.backend... is ceph, meaning the previous when should also answer this condition?  \n\nAnyway if the condition is just for 17, so please put it at the beginning of the when block.",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "17e09664_42a35415",
        "filename": "plugins/tripleo-overcloud/roles/containers/prepare-templates/tasks/build/build_images.yml",
        "patchSetId": 1
      },
      "lineNbr": 135,
      "author": {
        "id": 1017127
      },
      "writtenOn": "2022-01-10T15:54:33Z",
      "side": 1,
      "message": "Yes correct if its RHOS 17 it already meets the 14 \u003e\u003d condition, but since the ceph deployment changes started with 17 this command is only required if the deployment is using ceph and its 17 or greater, when using ceph this task is not required for RHOS Versions between 14 and 16.x.\n\nI don\u0027t follow what needs to be changed here.  Do you want #L125 to change to \u003e\u003d 17 or do you want #L132 - #L136 moved to the top of the conditionals?  If it\u0027s the former the task conditional needs to remain 14 \u003e\u003d since there are other pre 17 jobs dependent on executing this task for other reasons outside of deploying ceph.",
      "parentUuid": "4fe9cf31_7937ec28",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c4396d04_6736a45f",
        "filename": "plugins/tripleo-overcloud/roles/containers/prepare-templates/tasks/build/build_images.yml",
        "patchSetId": 1
      },
      "lineNbr": 135,
      "author": {
        "id": 1014217
      },
      "writtenOn": "2022-01-12T10:52:03Z",
      "side": 1,
      "message": "Beginning of the block I mean, L125 of course.",
      "parentUuid": "17e09664_42a35415",
      "revId": "16cb44379f3099dab2c780af91c15c32a37a4118",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}